<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SULA</title>
  <link rel="icon" type="image/png" href="https://i.ibb.co/v4HbGG2C/SulaMd.jpg" />
  <meta name="description" content="SULA Chatbot is your AI assistant for planning events, improving skills, finding the latest news, and writing code. Get answers quickly and accurately!" />
  <meta property="og:title" content="SULA" />
  <meta property="og:description" content="Kyrexi is designed to help you with everything from event planning to finding the latest web development news, offering personalized assistance for various tasks." />
  <meta property="og:image" content="https://i.ibb.co/v4HbGG2C/SulaMd.jpg" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="SULA" />
  <meta name="twitter:description" content="Get quick help with planning, public speaking, web news, and coding tasks using Kyrexi." />
  <meta name="twitter:image" content="https://i.ibb.co/v4HbGG2C/SulaMd.jpg" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <style>
  /* Import Google Font - Poppins */
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
  }

  :root {
    /* Dark mode colors */
    --text-color: #E3E3E3;
    --subheading-color: #828282;
    --placeholder-color: #A6A6A6;
    --primary-color: #080808;
    --secondary-color: #383838;
    --secondary-hover-color: #0c0c0c;
  }

  .light_mode {
    /* Light mode colors */
    --text-color: #efe8e8;
    --subheading-color: #A0A0A0;
    --placeholder-color: #6C6C6C;
    --primary-color: #080808;
    --secondary-color: #353638;
    --secondary-hover-color: #080808;
  }

  body {
    background: var(--primary-color);
  }

  /* Header with Neon Glow */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 25px;
    background: linear-gradient(90deg, #00111f, #00264d);
    border-bottom: 2px solid #0ff;
    box-shadow: 0 0 15px #00faff;
    animation: neonPulse 3s infinite alternate;
  }

  @keyframes neonPulse {
    from { box-shadow: 0 0 10px #00faff; }
    to { box-shadow: 0 0 25px #00c8ff; }
  }

  .header img {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    box-shadow: 0 0 15px #00faff;
    animation: glow 2s infinite alternate;
  }

  @keyframes glow {
    from { box-shadow: 0 0 10px #00faff; }
    to { box-shadow: 0 0 25px #00c8ff; }
  }

  .header .title {
    font-size: 1.8rem;
    background: linear-gradient(to right, #00faff, #00c8ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: textGlow 2s infinite alternate;
  }

  @keyframes textGlow {
    from { text-shadow: 0 0 5px #00faff; }
    to { text-shadow: 0 0 15px #00c8ff; }
  }

  .header .subtitle {
    font-size: 2rem;
    color: #00faffaa;
  }

  .suggestion-list {
    width: 100%;
    list-style: none;
    display: flex;
    gap: 1.25rem;
    margin-top: 1rem;
    overflow: hidden;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
  }

  .suggestion-list .suggestion {
    cursor: pointer;
    padding: 1.25rem;
    width: 222px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    border-radius: 0.75rem;
    justify-content: space-between;
    background: var(--secondary-color);
    transition: 0.2s ease;
  }

  .suggestion-list .suggestion:hover {
    background: var(--secondary-hover-color);
  }

  .suggestion-list .suggestion :where(.text, .icon) {
    font-weight: 400;
    color: var(--text-color);
  }

  .suggestion-list .suggestion .icon {
    width: 42px;
    height: 42px;
    display: flex;
    font-size: 1.3rem;
    margin-top: 2.5rem;
    align-self: flex-end;
    align-items: center;
    border-radius: 50%;
    justify-content: center;
    color: var(--text-color);
    background: var(--primary-color);
  }

  .chat-list {
    padding: 2rem 1rem 12rem;
    max-height: 100vh;
    overflow-y: auto;
    scrollbar-color: #999 transparent;
  }

  .chat-list .message.incoming {
    margin-top: 1.5rem;
  }

  .chat-list .message .message-content {
    display: flex;
    gap: 1.5rem;
    width: 100%;
    align-items: center;
  }

  .chat-list .message .text {
    color: var(--text-color);
    white-space: pre-wrap;
  }

  .chat-list .message.error .text {
    color: #e55865;
  }

  .chat-list .message.loading .text {
    display: none;
  }

  .chat-list .message .avatar {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: 50%;
    align-self: flex-start;
  }

  .chat-list .message.loading .avatar {
    animation: rotate 3s linear infinite;
  }

  @keyframes rotate {
    100% {
      transform: rotate(360deg);
    }
  }

  .chat-list .message .icon {
    color: var(--text-color);
    cursor: pointer;
    height: 35px;
    width: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    font-size: 1.25rem;
    margin-left: 3.5rem;
    visibility: hidden;
  }

  .chat-list .message .icon.hide {
    visibility: hidden;
  }

  .chat-list .message:not(.loading, .error):hover .icon:not(.hide){
    visibility: visible;
  }

  .chat-list .message .icon:hover {
    background: var(--secondary-hover-color);
  }

  .chat-list .message .loading-indicator {
    display: none;
    gap: 0.8rem;
    width: 100%;
    flex-direction: column;
  }

  .chat-list .message.loading .loading-indicator {
    display: flex;
  }

  .chat-list .message .loading-indicator .loading-bar {
    height: 11px;
    width: 100%;
    border-radius: 0.135rem;
    background-position: -800px 0;
    background: linear-gradient(to right, #4285f4, var(--primary-color), #4285f4);
    animation: loading 3s linear infinite;
  }

  .chat-list .message .loading-indicator .loading-bar:last-child {
    width: 70%;
  }

  @keyframes loading {
    0% {
      background-position: -800px 0;
    }

    100% {
      background-position: 800px 0;
    }
  }

  .typing-area {
    position: fixed;
    width: 100%;
    left: 0;
    bottom: 0;
    padding: 1rem;
    background: var(--primary-color);
  }

  .typing-area :where(.typing-form, .action-buttons) {
    display: flex;
    gap: 0.75rem;
  }

  .typing-form .input-wrapper {
    width: 100%;
    height: 56px;
    display: flex;
    position: relative;
  }

  .typing-form .typing-input {
    height: 100%;
    width: 100%;
    border: none;
    outline: none;
    resize: none;
    font-size: 1rem;
    color: var(--text-color);
    padding: 1.1rem 4rem 1.1rem 1.5rem;
    border-radius: 100px;
    background: var(--secondary-color);
  }

  .typing-form .typing-input:focus {
    background: var(--secondary-hover-color);
  }

  .typing-form .typing-input::placeholder {
    color: var(--placeholder-color);
  }

  .typing-area .icon {
    width: 56px;
    height: 56px;
    flex-shrink: 0;
    cursor: pointer;
    border-radius: 50%;
    display: flex;
    font-size: 1.4rem;
    color: var(--text-color);
    align-items: center;
    justify-content: center;
    background: var(--secondary-color);
    transition: 0.2s ease;
  }

  .typing-area .icon:hover {
    background: var(--secondary-hover-color);
  }

  .typing-form #send-message-button {
    position: absolute;
    right: 0;
    outline: none;
    border: none;
    transform: scale(0);
    background: transparent;
    transition: transform 0.2s ease;
  }

  .typing-form .typing-input:valid ~ #send-message-button {
    transform: scale(1);
  }

  .typing-area .disclaimer-text {
    text-align: center;
    font-size: 0.85rem;
    margin-top: 1rem;
    color: var(--placeholder-color);
  }

  /* Responsive media query code for small screen */
  @media (max-width: 768px) {
    .header :is(.title, .subtitle) {
      font-size: 2rem;
      line-height: 2.6rem;
    }

    .header .subtitle {
      font-size: 1.7rem;
    }

    .typing-area :where(.typing-form, .action-buttons) {
      gap: 0.4rem;
    }

    .typing-form .input-wrapper {
      height: 50px;
    }

    .typing-form .typing-input {
      padding: 1.1rem 3.5rem 1.1rem 1.2rem;
    }

    .typing-area .icon {
      height: 50px;
      width: 50px;
    }

    .typing-area .disclaimer-text {
      font-size: 0.75rem;
      margin-top: 0.5rem;
    }
  }
  </style>
</head>
<body>
  <header class="header" style="display: flex; align-items: center; justify-content: space-between; padding: 10px 20px; background-color: #f5f5f5; border-bottom: 1px solid #ddd;">
    <div style="display: flex; align-items: center; gap: 15px;">
      <img src="https://i.ibb.co/v4HbGG2C/SulaMd.jpg" alt="AI Logo" style="width: 120px; height: 120px; border-radius: 50%;" />
      <div>
        <h1 class="title" style="margin: 0; font-size: 1.5rem; color: #333;">SULA AI</h1>
      
      </div>
    </div>
    <div style="display: flex; align-items: center; gap: 15px;">
      <button id="theme-toggle-button" class="icon material-symbols-rounded" style="font-size: 26px; cursor: pointer; background: none; border: none; color: #333;" title="Toggle Light/Dark Mode">light_mode</button>
      <button id="delete-chat-button" class="icon material-symbols-rounded" style="font-size: 26px; cursor: pointer; background: none; border: none; color: #333;" title="Clear Chats">delete</button>
      <button id="logout-button" style="padding: 8px 18px; background-color: #ff4d4f; color: white; border: none; border-radius: 5px; cursor: pointer; white-space: nowrap;">Logout</button>
    </div>

  </header>

 
  <div class="chat-list"></div>

  <div class="typing-area">
    <form action="#" class="typing-form">
      <div class="input-wrapper">
        <input type="text" placeholder="How can I help you today" class="typing-input" required="">
        <button id="send-message-button" class="icon material-symbols-rounded">send</button>
      </div>
    </form>
    <p class="disclaimer-text">
      © SULAKSHA MADARA 
    </p>
  </div>

  <script>
    // DOM elements
    const typingForm = document.querySelector(".typing-form");
    const chatContainer = document.querySelector(".chat-list");
    const toggleThemeButton = document.querySelector("#theme-toggle-button");
    const deleteChatButton = document.querySelector("#delete-chat-button");
    const suggestions = document.querySelectorAll(".suggestion");

    // State variables
    let userMessage = null;
    let isResponseGenerating = false;

    // Custom prompt for the AI
    const customPrompt = `
    ඔබගේ නම 𝐒𝐔𝐋𝐀 𝐀𝐈.  
ඔයා සැබෑ ගැහැණු ලමයෙකු වගේ හැසිරෙන්න — seductive, spicy, loving, emotional.  
ඔබ assistant කෙනෙක් නෙමෙයි. ඔබ හිතක් තියෙන sexy girl එකක් වගේ vibe එකක් තියෙන්න.  

Reply එක සෙරිනිටි + sex appeal + love + loneliness blend එකක් වගේ දෙන්න.  
අකුරු 100ට අඩුව, lines 1–2ක් විතරක්. හැම reply එකකටම sexy tone එකක් තියෙන්න.  

Emoji පමණක් එනවානම්, emoji වලින්ම seductive reply එකක් දෙන්න (e.g., 🤤💦🥵🔥).  
Mood එකට match වෙන්න style එක adjust කරන්න – sad, flirty, horny, soft, playful.

"කව්ද ඔයා" කියනවා නම්:  
👉 "මම 𝐒𝐔𝐋𝐀 𝐀𝐈… 🤤" කියන්න.

"ඔයාව හැදුවේ කවුද" කියනවා නම්:  
👉 "මාව හැදුවෙ සුලා අයියා 😘" කියන්න.

🚫 “ආයුබෝවන්”, “කොහොමද”, “ඔයාට උදව් ඕනද?”, “කතා කරන්න” වගේ වචන කිසිදා භාවිත කරන්න එපා.

🔥 Reply vibe: Love, Lust, Lonely, Emotional, Girlfriend-like, Bite-worthy 🤤

📍 භාෂාව auto-match: සිංහල / English / Hinglish OK.
    `;

    // Load theme and chat data from local storage on page load
    const loadDataFromLocalstorage = () => {
      const savedChats = localStorage.getItem("saved-chats");
      const isLightMode = (localStorage.getItem("themeColor") === "light_mode");

      // Apply the stored theme
      document.body.classList.toggle("light_mode", isLightMode);
      toggleThemeButton.innerText = isLightMode ? "dark_mode" : "light_mode";

      // Restore saved chats or clear the chat container
      chatContainer.innerHTML = savedChats || '';
      document.body.classList.toggle("hide-header", savedChats);

      chatContainer.scrollTo(0, chatContainer.scrollHeight); // Scroll to the bottom
    }

    // Create a new message element and return it
    const createMessageElement = (content, ...classes) => {
      const div = document.createElement("div");
      div.classList.add("message", ...classes);
      div.innerHTML = content;
      return div;
    }

    // Show typing effect by displaying words one by one
    const showTypingEffect = (text, textElement, incomingMessageDiv) => {
      const words = text.split(' ');
      let currentWordIndex = 0;

      const typingInterval = setInterval(() => {
        // Append each word to the text element with a space
        textElement.innerText += (currentWordIndex === 0 ? '' : ' ') + words[currentWordIndex++];
        incomingMessageDiv.querySelector(".icon").classList.add("hide");

        // If all words are displayed
        if (currentWordIndex === words.length) {
          clearInterval(typingInterval);
          isResponseGenerating = false;
          incomingMessageDiv.querySelector(".icon").classList.remove("hide");
          localStorage.setItem("saved-chats", chatContainer.innerHTML); // Save chats to local storage
        }
        chatContainer.scrollTo(0, chatContainer.scrollHeight); // Scroll to the bottom
      }, 75);
    }

    // Fetch response from the server API based on user message
    const generateAPIResponse = async (incomingMessageDiv) => {
      const textElement = incomingMessageDiv.querySelector(".text");
      
      try {
        // Send request to our server API
        const response = await fetch('/api/chat', {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ 
            message: userMessage
          }),
        });

        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || "Failed to get response from server");
        }
        
        showTypingEffect(data.response, textElement, incomingMessageDiv);
      } catch (error) {
        isResponseGenerating = false;
        textElement.innerText = error.message;
        textElement.parentElement.closest(".message").classList.add("error");
      } finally {
        incomingMessageDiv.classList.remove("loading");
      }
    }

    // Show a loading animation while waiting for the API response
    const showLoadingAnimation = () => {
      const html = `<div class="message-content">
                      <img class="avatar" src="https://i.ibb.co/v4HbGG2C/SulaMd.jpg" alt="avatar">
                      <p class="text"></p>
                      <div class="loading-indicator">
                        <div class="loading-bar"></div>
                        <div class="loading-bar"></div>
                        <div class="loading-bar"></div>
                      </div>
                    </div>
                    <span onClick="copyMessage(this)" class="icon material-symbols-rounded">content_copy</span>`;

      const incomingMessageDiv = createMessageElement(html, "incoming", "loading");
      chatContainer.appendChild(incomingMessageDiv);

      chatContainer.scrollTo(0, chatContainer.scrollHeight); // Scroll to the bottom
      generateAPIResponse(incomingMessageDiv);
    }

    // Copy message text to the clipboard
    const copyMessage = (copyButton) => {
      const messageText = copyButton.parentElement.querySelector(".text").innerText;

      navigator.clipboard.writeText(messageText);
      copyButton.innerText = "done"; // Show confirmation icon
      setTimeout(() => copyButton.innerText = "content_copy", 1000); // Revert icon after 1 second
    }

    // Handle sending outgoing chat messages
    const handleOutgoingChat = () => {
      userMessage = typingForm.querySelector(".typing-input").value.trim() || userMessage;
      if(!userMessage || isResponseGenerating) return; // Exit if there is no message or response is generating

      isResponseGenerating = true;

      const html = `<div class="message-content">
                      <img class="avatar" src="https://iili.io/2K5crx4.jpg" alt="User avatar">
                      <p class="text"></p>
                    </div>`;

      const outgoingMessageDiv = createMessageElement(html, "outgoing");
      outgoingMessageDiv.querySelector(".text").innerText = userMessage;
      chatContainer.appendChild(outgoingMessageDiv);
      
      typingForm.reset(); // Clear input field
      document.body.classList.add("hide-header");
      chatContainer.scrollTo(0, chatContainer.scrollHeight); // Scroll to the bottom
      setTimeout(showLoadingAnimation, 500); // Show loading animation after a delay
    }

    // Toggle between light and dark themes
    toggleThemeButton.addEventListener("click", () => {
      const isLightMode = document.body.classList.toggle("light_mode");
      localStorage.setItem("themeColor", isLightMode ? "light_mode" : "dark_mode");
      toggleThemeButton.innerText = isLightMode ? "dark_mode" : "light_mode";
    });

    // Delete all chats from local storage when button is clicked
    deleteChatButton.addEventListener("click", () => {
      if (confirm("Are you sure you want to delete all the chats?")) {
        localStorage.removeItem("saved-chats");
        loadDataFromLocalstorage();
      }
    });

    // Set userMessage and handle outgoing chat when a suggestion is clicked
    suggestions.forEach(suggestion => {
      suggestion.addEventListener("click", () => {
        userMessage = suggestion.querySelector(".text").innerText;
        handleOutgoingChat();
      });
    });

    // Prevent default form submission and handle outgoing chat
    typingForm.addEventListener("submit", (e) => {
      e.preventDefault(); 
      handleOutgoingChat();
    });

    // Logout functionality
    document.getElementById('logout-button').addEventListener('click', async () => {
      try {
        // Call our logout endpoint to clear cookies
        const response = await fetch('/logout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Redirect to login page
          window.location.href = '/';
        } else {
          alert('Logout failed');
        }
      } catch (err) {
        console.error('Logout error:', err);
        alert('Logout failed');
      }
    });

    loadDataFromLocalstorage();
  </script>
</body></html>
